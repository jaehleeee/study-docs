### 카프카 브로커의 또 하나의 주요 역할 - 데이터 저장
 * 카프카를 실행할 때, config/server.properties의 log.dir 옵션에 정의한 디렉토리에 데이터를 저장한다.
 * 토픽 이름과 파티션 번호의 조합으로 하위 디렉토리를 생성하여 데이터를 저장한다
   * 하위 디렉토리 안에는 메시지와 메타데이터를 저장한다. (log, index, timeIndex)
 * 한번 저장된 레코드는 수정이 불가능하다.
 * 또한 세그먼트 단위로 삭제되므로 레코드 단위로 개별 삭제도 불가능하다.


### 로그와 세그먼트
 * 로그는 세그먼트로 나눠진다.
 * 세그먼트 파일로 나누는 기준은 용량 또는 시간이다.
   * log.segment.bytes : 바이트 단위 최대 세그먼트 지정. 기본값은 1GB
   * log.roll.ms(hours) : 세그먼트가 신규 생성된 후 다음 파일로 넘어가는 주기. 기본값은 7일
 * 세그먼트 파일에는 offset들이 순서대로 들어간다.
   * 안에 들어있는 offset 중 가장 빠른 offset 번호가 세그먼트 파일의 이름이 된다.
 * 가장 최근에 쓰여진 세그먼트를 액티브 세그먼트라고 부른다.
   * 액티브 세그먼트는 브로커의 삭제 대상에 포함되지 않는다.
   * 액티브 세그먼트가 아닌 세그먼트들은 retention 옵션에 따라 삭제 대상이 된다.


 ### 세그먼트와 석제주기 (cleanup.policy=delete)
  * retention.ms(minutes,hours) : 세그먼트 최대 보유 기간, 기본 7일 (3일을 권장)
  * retention.byptes : 파티션당 로그 적재 바이트 값. 기본값은 -1 (지정X)
  * log.retention.check.interval.ms : 세그먼트가 삭제 영역에 들어왔는지 확인하는 간격. 기본값은 5분
 
 
 ### 삭제하고 싶지 않다면, 압축 (cleanup.policy=compact)
  * 토픽 압축 정책은 zip같은 일반적인 압축과 다르다
  * 여기서 압축이란 메시키 키 별로 해당 메시지 키의 레코드 중 오래된 데이터를 삭제하는 정책이다.
    * 브로커 단위로 메시지의 키에 대한 레코드가 여러개일때 그 중 가장 최신 레코드만 남긴다
    * (물론 active 세그먼트는 대상에서 제외된다)
  * 그래서 삭제 정책과는 다르게 일부 레코드만 삭제된다.

![image](https://github.com/jaehleeee/study-docs/assets/48814463/54ba1602-a1e6-4c18-a519-ae25001f47c2)
