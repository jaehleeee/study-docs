# 복제 (Replicaiton)

## 복제란?
 * 복제 기능은 카프카 장애 허용 시스템 (fault tolerant system)의 원동력
 * 카프카의 복제는 파티션 단위로 이뤄진다.
 * 복제 개수(replication factor)는 브로커 개수 만큼 설정할 수 있다.
   * factor 3 이면, 리더 파티션 1개와 팔로워 파티션 2개로, 2개의 복제품이 생성된다.
   * 프로듀서와 직접 통신하는 파티션을 리더, 나머지를 팔로워라고 부른다.
   * 팔로워들은 리더의 오프셋을 확인하여 자신의 오프셋과 차이가 나는 경우 리더로부터 데이터를 가져와서 자신의 파티션에 저장한다.
 * 장애가 발생하면,
    * 해당 브로커의 리더 파티션은 사용될 수 없으므로
    * 팔로워 중 하나가 리더로 승급된다.
  
## ISR (In-Sync-Replicas)
 * ISR : 리더와 팔로워가 모두 싱크되었다는 뜻. 즉 오프셋이 동일하다.
 * ISR이 안되어 있을때 브로커에 장애가 발생하면 데이터 유실이 발생할 수 있다.
 * `unclean.leader.elction.enable` = true로 설정하면 유실을 감수하며, 복제가 안된 팔로워 파티션을 리더로 승급한다.
 *   * false 라면 유실을 감수하지 않겠다는 뜻이고, 브로커 복구될떄까지 데이터 처리를 중단한다.
