# 카프카 브로커와 클러스터

### 클러스터
 * 브로커가 여러대로 운영 (보통 3대)

### 주키퍼
 * 카프카 클러스터를 운영하기 위해 필요
 * 2.대 버젼에선 필수, 3.대 버젼에선 완전 필수는 아니지만 그래도 대부분 주키퍼를 운영

### 브로커
 * 클라이언트와 데이터를 주고 받는 주체
 * 장애가 발생하더라도 클러스터로 묶인 브로커들이 데이터를 분산 저장 및 복제하므로 안전하다.

### 브로커 역할
#### 컨트롤러
 * 클러스터의 여러 브로커 중 한대가 컨트롤러 역할을 한다.
 * 브로커들의 상태를 체크하고 문제가 생긴 브로커가 클러스터에서 빠지면 해당 브로커에 존재하는 리더 파티션을 재분배한다.
 * 컨트롤러 역할을 하는 브로커에 장애가 ㄷ생기면 다른 브로커가 컨트롤러 역할을 한다.
#### 데이터 삭제
 * 데이터 삭제는 파일 단위로 이뤄지는데 이 단위를 `로그 세그먼트`라고 부른다.
 * 이 세그먼트에 다수의 데이터가 들어있기 때문에 특정 데이터만 선별해서 삭제할 수 없다.
#### 컨슈머 오프센 저장
 * 컨슈머 그룹은 특정 파티션을부터 데이터를 가져가서 처리하고 어느 레코드까지 가져갔는지 확인하기 위해 오프셋을 커밋한다.
 * 커밋한 오프셋은 `__consumer_offsets` 토픽에 저장한다. (자동 생성되는 토픽)
#### 그룹 코디네이터
 * 컨슈머 그룹의 상태를 체크하고 파티션을 컨슈머와 매칭되도록 분배하는 역할을 한다.
 * 컨슈머에 문제가 생겨 컨슈머 그룹에서 빠지면, 이로인해 빠진 파티션을 정상 동작하는 컨슈머로 재할당한다. 이를 리밸런싱이라고 부른다.
