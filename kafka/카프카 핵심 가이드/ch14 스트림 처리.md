# 14장 스트림 처리

## 퀴즈와 정답
 * 결과 레코드가 집계 여산의 결과물일때, 집계에 사용된 레코드 타임스탬프의 최소 값을 결과 레코드의 타임스탬프로 사용한다. (O, X) X 428p
 * puctuate() 같이 입력과 상관없이 특정 스케쥴에 따라 데이터를 생성하는 결과 레코드의 경우 타임스탬프 값은 스트림 처리 애플리케이션 현재 내부 시각에 따라 결정된다. (O, X) O 428p
 * 카프카 스트림즈는 로컬 상태를 내장된 RocksDB 를 사용함으로써 인메모리 방식으로 저장하지만 노드 장애시 유실된다.(O, X) X 436p
    * change log 토픽을 사용해서 변경사항을 저장한다.  
* 카프카 스트림즈에서 조인할 2개 스트림이 똑같은 조인키에 파티셔닝되어 있을 경우
* 카프카 장애시 복구 시간을 줄이려면? (458)
  * min.compaction.lag.ms를 낮추고, 세그먼트 크기는 기본값이 1gb 대신 100mb 정도로 낮춰놓는다.
  * 더 빠른 복구를 원한다면 스탠바이 레플리카 설정을 권장함. 

## 내용
### 프로그래밍 패러다임
 * 요청-응답
   * 가장 지연이 적다.
   * 블로킹 방식 
 * 배치 처리
   * 지연이 크지만 처리량도 크다.  
 * 스트림 처리
   * 연속적이고 논블로킹 방식
   * 스트림 처리는 지속적으로 계속되어야 한다.


### 이벤트 처리 시간 개념
 * 이벤트 시간 (event time) : 레코드 생성 시점. 0.10.0 이후 카프카는 프로듀서에서 기본적으로 현재시각을 추가하도록 되어 있다.
 * 로그추가 시간 (log append time) : 카프카 브로커로 전달된 시간. ingestion time 이라고도 불림.
 * 처리 시간 (processing time) : 스트림 처리 애플리케이션이 뭔가 연산을 수행하기 위해 이벤트를 받은 시간.

### 정확히 한번 보장
 * 카프카 스트림즈는 processing.guarantee 설정을 exactly_once로 ㅈ바아줌으로써 정확히 한번 보장 기능을 활성화할 수 있다.

### 조인키 파티셔닝
> Kafka Streams에서 **"조인 키에 파티셔닝한다"**는 말은
👉 조인하려는 두 개의 스트림이 같은 조인 키 기준으로 같은 파티션에 저장되도록 정렬한다는 뜻이야.
즉, 같은 조인 키를 가진 데이터를 같은 파티션에 존재하도록 데이터를 배치하는 과정을 의미해.
만약 조인 키 기준으로 파티셔닝이 다르면 Kafka Streams는 자동으로 리파티셔닝을 수행하지만, 추가적인 네트워크 비용이 발생한다.
 * 파티션 개수를 동일하게 맞춘다??
