# 10장 클러스터간 데이터 미러링하기

## 퀴즈와 정답
 * 데이터센터간 통신의 현실적 문제들 (262p)
   * 높은 지연
   * 제한된 대역폭 - 광역 통신망은 일반적으로 당일 데이터센터 내부보다 훨씬 낮은 대역폭을 가지며 사용가능한 대역폭 역시 시시각각 변하는 특성을 가지고 있다.
   * 더 높은 비용
 * 재해복구 계획시 염두에 둘 지표 2가지 (268p)
   * 복구 시간 목표 (RTO) - 모든 서비스가 장애가 발생한 뒤 다시 작동을 재개할 때까지의 최대 시간
   * 복구 지점 목표 (RPO) - 장애 결과로 인해 데이터 유실될 수 있는 최대 시간 
 * 오프셋 토픽 복제의 주의사항 3가지 (270p)
   * 주 클러스터의 오프셋이 DR클러스터의 오프셋과 일치할 것이란 보장이 없다.
   * 프로듀서 재시도로 오프셋이 서로 달라질 수 있다.
   * 주 클러스터와 DR 클러스터 사이에 랙이 존재할 수 있다. (미러링 솔루션은 트랜잭션 기능을 지원하지 않는다.)
 * 장애 복구 끝나고, 주 클러스터를 DR 클러스터로 역할 변환하려고 할때 가장 간단한 해법 (273p)
   * 주 클러스터에 저장된 데이터와 커밋된 오프셋을 완전히 삭제한 뒤 새로운 주 클러스터에서 완전히 새것이 된 새 DR 클러스터로 미러링을 시작하는 것 

## 데이터센터간 통신을 위해 카프카를 조정한 아키텍처별 장단점
 * 허브 앤 스포크 아키텍처
   * 여러 로컬 카프카 클러스터와 한개의 중앙 카프카 클러스터가 있음.
   * 용도: 데이터는 여러 데이터센터에서 생성되는 반면, 일부 컨슈머는 전체 데이터를 사용해야할 경우
   * 장점: 항상 로컬에서 생성, 중앙은 저장되는 단방향 구조이므로 배포, 설정, 모니터링이 간편하다.
   * 단점: 지역 데이터센터의 애플리케이션은 다른 데이터센터에 있는 데이터를 사용할 수 없다.
  
 * 액티브-액티브 아키텍처
   * 2개 이상의 데이터센터가 전체 데이터의 일부 혹은 전체를 공유
   * 용도: 각 데이터센터가 모두 읽기와 쓰기를 수행할 수 있어야 하는 경우
   * 장점: 인근 데이터센터에서 사용자들의 요청을 처리할 수 있다느 점, 데이터 중복과 회복 탄력성 (한 센터가 장애가 나더라도 사용자 요청 처리 가능)
   * 단점: 데이터를 여러 위치에서 비동기적으로 읽기나 변경할 경우 발생하는 충돌을 피하기 어렵다.
      * 두 데이터센터 간 데이터 일관성을 유지하는 것이 어렵다.
      * 예시
         * 한 데이터센터에서 쓰고, 다른 데이터센터에서 읽으려고 하는 경우 정합성 불일치 - 같은 사용자는 동일 클러스터 쓰는 방법 마련 필요
         * 양쪽 데이터센터에서 실행되는 애플리케이션이 서로 다른 데이터센터에서 서로 배치되는 이벤트가 들어올 경우 이를 처리하는 일관적인 규칙 필요
      * 양방향 미러링 작업이 필요한 점
      * 끝없는 데이터 순환을 막아야 한다 - 데이터센터별로 별도의 토픽을 두고, 원격 데이터센터에서 생성된  토픽의 복제를 막ㅇ므으로써 해결

 * 액티브-스탠바이 아키텍쳐
   * ㅇㅇ
 * 스트레치 클러스터 
