# 6장 키-값 저장소 설계
 * 키-값 저장소는 키-값 데이터베이스라고 볼리는 비 관계형 데이터베이스이다.
 * 키-값 쌍에서 키는 유일해야 하며, 해당 키에 매달린 값은 키를 통해서만 접근할 수 있다.
 * 키는 일반 텍스트일 수도 있고, 해시 값일수도 있다.
 * 성능상의 이유로 키는 짧을수록 좋다.


## 문제 이해 및 설계 범위 확정
 * 완벽한 설계란 없다.
 * 읽기, 쓰기 그리고 메모리 사용량 사이에 어떤 균형을 찾고, 데이터의 일관성과 가용성 사이에서 타협적 결정을 내린 설계를 만들면 쓸만한 답안이다.

### 조건
![image](https://github.com/jaehleeee/study-docs/assets/48814463/444ac64f-4332-4b85-824b-0f55ae96c707)

## 단일 서버 키-값 저장소
 * 가장 직관적인 방법은 키-값 쌍 전부를 메모리에 해시 테이블로 저장하는 것
 * 빠르지만 모든 데이터를 메모리 안에 두는 것은 불가능
 * 개선책
   * 데이터 압축
   * 자주 쓰이는 데이터만 메모리에 두고 나머지는 디스크 저장
 * 이렇게 개선해도 언젠가 한 대 서버로 부족한 때가 곧 찾아온다.

## 분산 키-값 저장소
 * 분산 키-값 저장소는 분산 해시 테이블 이라고도 불린다.
 * 분산 시스템을 설계할 때는 CAP 정리를 이해하고 있어야 한다.

### CAP 정리
 * CAP 정리는 데이터 일관성(Consistency), 가용성(Availability), 파티션 감내(Partition tolerange) 라는 3가지 요구사항을 동시에 만족하는 분산 시스템을 설계하는 것은 불가능하다는 정리다.
 * 데이터 일관성(Consistency) : 클라이언트는 어떤 노드에 접속해도 같은 데이터를 봐야한다.
 * 가용성(Availability) : 클라이언트는 일부 노드에 장애가 발생해도 항상 응답을 받을 수 있어야 한다.
 * 파티션 감내(Partition tolerange) : 파티션은 두 노드 사이에 통신 장애가 발생했음을 의미. 네트워크에 파티션이 생기더라도 시스템은 계속 동작해야함을 의미.
 * 이 3가지 사항 중 2가지를 충족하려면 반드시 1가지는 희생되어야 한다.
 * 실세계에서 통상 네트워크 장애는 피할 수 없으므로, 일관성과 가용성 둘 중 하나를 포기할 수 밖에 없다.

### 실 예시
![image](https://github.com/jaehleeee/study-docs/assets/48814463/e8d3e8a7-38f3-4918-a317-2c6e2004741e)

#### 데이터 일관성을 선택한다면?
 * 데이터 불일치를 중단시키기 위해 n1, n2 쓰기 중단
 * 특히 은행권 시스템에서 데이터 일관성을 선택한다.
 * 상황이 해결될때까지 오류를 반환해야 한다.

#### 가용성을 선택한다면?
 * 설사 낡은 데이터를 반환하더라도 계속 읽기 연산 허용
 * n1, n2는 쓰기 허용
 * 파티션 문제가 해결되면 새 데이터를 n3에 전송

## 시스템 컴포넌트 살펴보기
### 데이터 파티션 





