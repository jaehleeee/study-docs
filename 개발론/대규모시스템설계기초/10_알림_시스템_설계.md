# 10장 알림 시스템 설계
 * 알림 시스템은 모바일 푸시, SMS 메시지, 이메일 이렇게 3가지로 분류 가능.

## 1단계 문제 이해 및 설계 범위 확정
 * 3가지 알림 모두 지원
 * 연성 실시간 (시스템 부하 걸렸을때는 약간의 지연 허용)
 * 사용자가 알림 받지 않도록 설정
 * 하루 천만 건 모바일, 백만건 sms, 500만건 이메일

## 2단계 개략적 설계안 제시 및 동의 구하기
### 알림 유형별 지원 방안
#### IOS
 * 알림 제공자 -> APNS(Apple Push notification Service) -> IOS 단말
 * device token, payload 필요
#### 안드로이드
 * APNS 대신 FCM(Firebase Cloud Messaging)을 쓴다.
#### SMS
 * 트윌리오, 넥스모 같은 제 3자 사업자 서비스 많이 사용
#### 이메일
 * 센드그리드, 메일침프 같은 상용 이메일 서비스 사용

### 설계안 초안
![image](https://github.com/jaehleeee/study-docs/assets/48814463/9cc3fc26-7915-4f21-a464-e44c7ed1b3bc)

### 초안 설계의 문제점
 * SPOF
 * 규모 확장성, 서버 한대로 진행하다보니 디비, 캐시 등의 컴포넌트를 붙이기 어렵다.
 * 성능 병목

### 개선된 설계안
 * 디비와 캐시를 알림 시스템의 주 서버에서 분리
 * 알림 서버를 증설하고 자동으로 스케일 아웃 가능
 * 메시지 큐를 통해 시스템 컴포넌트 사이 강한 결합 끊는다.
 * 알림 서버의 기능
    * 알림 전송 API : 인증된 클라이언트만 이용 가능
    * 알림 검증 : 메일주소, 전화번호 등을 검증
    * 데이터베이스 또는 캐시 질의
    * 알림 전송 : 알림 데이터를 큐에 넣는다.  
![image](https://github.com/jaehleeee/study-docs/assets/48814463/cea86dbd-7004-4ee8-b925-6b742c9ad240)

## 3단계 상세 설계
 * 안정성과 추가 필요 컴포넌트 및 고려사항에 대해 알아보자.
### 안정성
 * 어떤 상황에서도 알림이 소실되면 안된다.
 * 지연되거나 순서 틀린건 괜찮다.
 * 알림 데이터를 dB에 보관하고 재시도 매커니즘을 구현해야 한다.
### 중복 방지
 * 중복 알림은 완전히 막는 것은 가능하지 않다.
 * 이베트 id 를 통해 중복 방지 로직을 추가하자.

### 필요 컴포넌트 및 고려사항
 * 알림 템플릿
 * 알림 설정 (사용자마다 설정을 테이블에 보관)
 * 전송률 제한 (사용자에게 너무 많은 알림 가지 않도록)
 * 재시도 방법
 * 큐에 쌓이는 알람 모니터링
 * 알림 확인율, 클릭율 등 이벤트 추적

### 수정된 설계안
![image](https://github.com/jaehleeee/study-docs/assets/48814463/42704758-892e-4c66-be76-626aab4d693a)


## 4단계 마무리
이번장에서 집중한 부분
 * 재시도 매커니즘
 * 보안
 * 이벤트 추적 및 모니터링
 * 사용자 설정
 * 전송률 제한
