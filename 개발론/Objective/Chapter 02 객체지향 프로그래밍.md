# 01 영화 예매 시스템

- 용어 정리
    - 영화 Movie : 제목, 상영 시간, 가겨 정보 등의 영화에 대한 기본정보
    - 상영 Screening : 실제로 관객들이 영화를 관람하는 사건 - 상영 일자, 시간, 순번
    - 할인 정책 discount policy - 얼마나 할인해줄지, 영화별로 하나의 할인 정책만 적용 가능
        - 금액 할인 정책
        - 비율 할인 정책
    - 할인 조건 discount condition - 언제 할인해줄지, 영화별로 여러 할인 조건이 적용될 수 있다 
        - 순서 조건 : 몇번째 순번인 영화 할인해준다.
        - 기간 조건 : 요일, 시작시간, 종료 시간으로 구성되며 영화 시작 시간이 해당 기간에 포함되면 할인해준다

  

# 02 객체지향 프로그래밍을 향해

#### 협력, 객체, 클래스

- 대부분 사람들은 클래스를 결정한 후 속성과 메서드를 결정
    - 이는 객체지향 본질과 멀다.
    - 진정한 객체지향은 클래스가 아닌 객체에 초점을 맞춰야 한다.
- 객체지향을 위해 집중해야할 2가지
    1. 어떤 클래스가 필요한지 고민 전에 어떤 객체들이 필요한지 고민해라.
        - 클래스는 공통적인 상태와 행동을 공유하는 객체들을 추상화한 것이다.
    2. 객체를 독립적인 존재가 아니라 기능을 구현하기 위해 협력하는 공동체의 일원으로 봐야한다.
        - 객체를 협력하는 공동체의 일원으로 바라보는 것은 설게를 유연하고 확장 가능하게 만든다.

#### 도메인의 구조를 따르는 프로그램 구조

- 문제를 해결하기 위해 사용자가 프로그램을 사용하는 분야를 **도메인** 이라고 부른다.
- 객체지향 패러다임이 강력한 이유는?
    - 요구사항을 분석하는 초기 단계부터 프로그램을 구현하는 마지막 단계까지 객체라는 동일한 추상화 기법을 사용할 수 있기 때문.

![](https://wiki.navercorp.com/download/attachments/1351799544/image-2023-3-22_21-53-47.png?version=1&modificationDate=1679522028000&api=v2 "LEE JAE HYEON[ 이재현 ] > Chapter 02 객체지향 프로그래밍 > image-2023-3-22_21-53-47.png")

  

#### 클래스 도메인 구현하기

- 인스턴스 변수는 private,  메서드 가시성은 public
- 외부에서 객체 속성 접근 막고, 적절한 메서드 통해서만 내부 상태를 변경할 수 있게 해야 한다.
- 내/외부를 구분해야 하는 이유는?
    - 경계의 명확성이 객체의 자율성을 보장하기 때문.
    - (더 중요) 프로그래머에게 구현의 자유를 제공하기 때문.
- 자율적인 객체
    - 객체는 상태와 행동을 함께 가지는 복합적 존재
    - 객체는 스스로 판단하고 행동하는 자율적인 존재
    - 객체가 자율적인 존재로 우뚝서려면 외부의 간섭을 최소화해야 한다.
    - 외부에서 접근 가능한 부분을 **퍼블릭** **인터페이스**
    - 외부에서 접근 불가능하고 오직 내부에서만 접근 가능한 부분을 **구현** 이라고 부른다.
- 프로그램의 자유
    - 프로그래머는 2가지로 구분
        - 클래스 작성자 - 새로운 데이터 타입 추가
        - 클라이언트 프로그래머 - 추가된 데이터 타입 사용 
    - 클라이언트 프로그래머에게 필요한 부분만 공개하고 나머지는 모두 숨겨야한다. : **구현 은닉** 이라고 한다.
    - 구현 은닉은 모두에게 유용
        - 클라 프로그래머는 알아야 할 지식 양을 줄일 수 있다.
        - 클래스 작성자는 외부 영향 걱정없이 내부 구현을 맘대로 변경할 수 있다.
    - 셜계가 필요한 이유는 변경 관리를 위해서다.
        - 접근 제어는 객체 변경을 관리하는 대표적인 방법이다

#### 협력하는 객체들의 공동체

- Screening은 요금 계산을 위해 calculateFee 메서드를 호출하는데, 이는 Movie의 calculateMovieFee를 호출하여 계산한다.
- 필요시 Money 라는 타입을 만드는 것이 Long 타입을 그냥 쓰는 것 보다 좋다.
    - 돈이라는 의미를 분명히 전달할 수 있고
    - 금액과 관련된 로직이 서로 다른 곳에 중복 구현되는 것을 막을 수 있다.

#### 협력에 관한 짧은 이야기

- 객체가 다른 객체와 상호작용할 수 있는 유일한 방법은 메세지를 전송하고 수신하는 것이다.
- 메시지를 수신한 객체는 스스로 결정에 따라 자율적으로 메시지를 처리할 방법을 결정한다. 이를 메서드 라고 부른다.
- 메시지와 메서드를 구분하는 것이 매우 중요하다.
    - 여기서 다형성 개념 출발한다.
    - Screeing은 Movie의 calculateMovieFee를 호출한다.  → 이는 Screeing이 Movie에게 calculateMovieFee 메시지를 전송한다고 표한하는 것이 더 적절하다.
    - Screeing은 calculateMovieFee이 어떻게 처리되는지 모른다. 이는 Movie가 자율적으로 적절한 메서드를 선택하여 처리한다.
        - 객체가 메시지를 자율적으로 처리한다고 말하는 이유다.

# 03 할인 요금 구하기

#### 할인요금 계산을 위한 협력 시작하기

- 할인 정책을 결정하기 위해서 Movie는 discountPolicy로 메시지를 전송할 뿐이다.

#### 할인 정책과 할인 조건

- 할인 정책은 금액 할인 정책과 비유 할인 정책으로 구분된다.
- 할인 정책
    - 대부분 코드가 유사하고 요금 계산 방식만 다르다 → 추상 클래스를 활용한다.
    - 할인 정책에는 여러가지 할인 조건(discountCondition)이 적용될 수 있다.
    - 하나 이상의 할인 조건이 적용되면, 
        - getDiscountAmount(Screening  screening) 추상메서드를 호출한다. → 자식 클래스로 상세 구현 위임
    - 이처럼 부모 클래스에서 기본적인 흐름을 구현하고, 중간에 필요한 처리를 자식 클래스로 위임하는 패턴을 템플릿 메서드 패턴이라고 한다.
- 할인 조건
    - 순번 조건과 기간 조건이 있다.
    - 할인 정책과 다르게, interface를 이용한다.

#### 할인 정책 구성하기

- -

  

# 04 상속과 다형성

#### 컴파일 시간 의존성과 실행 시간 의존성

- Movie 클래스는 DiscountPolicy와 연결
- 그러나 실제 요금을 계산하려면 AmountDiscountPolicy나 PercentDiscountPolicy 가 필요하다.
    - 이들은 실행 시점에 Movie에 의존하게 된다.
- 즉, 코드의 의존성과 실행 시점 의존성이 다를 수 있다는 것이다.
    - 이게 다르면, 코드를 이해하기가 어려워진다.
    - 반면에서 코드는 더 유연해지고 확장 가능해진다.
    - → 설계가 트레이드워프의 산물이라는 사실을 보여준다.
- 의존하는 객체를 정확히 알기 위해선는, Movie 인스턴스가 생성하는 부분을 잘 살펴야한다.

![](https://wiki.navercorp.com/download/attachments/1351799544/image-2023-3-22_22-48-58.png?version=1&modificationDate=1679525340000&api=v2 "LEE JAE HYEON[ 이재현 ] > Chapter 02 객체지향 프로그래밍 > image-2023-3-22_22-48-58.png")

  

#### 차이에 의한 프로그래밍

- 클래스를 하나 추가하고 싶은데 기존 어떤 클래스와 매우 흡사하다고 가정하자.
- 그 클래스의 흡사한 코드를 그대로 재사용하는 방법이 상속이다.
- 부모 클래스와 다른 부분만을 추가해서 새로운 클래스를 쉽고 빠르게 만다는 방법을 **차이에 의한 프로그래밍**이라고 한다.

#### 상속과 인터페이스

- 상속이 가치 있는 이유는 부모 클래스가 제공하는 모든 인터페이스를 자식 클래스가 물려 받을 수 있기 때문.
    - (상속을 바라보는 인식과 거리가 있는데 대부분 상속의 목적을 메서드나 인스턴스 변수 재사용으로 생각하기 때문)
- 인터페이스는 객체가 이해할 수 있는 메시지의 목록을 정의한다는 것을 기억하라.
- 자식 클래스는 부모 클래스가 수신할 수 있는 모든 메시지를 수신할 수 있기 때문에 외부 객체는 자식 클래스를 부모 클래스와 동일한 타입으로 간주할 수 있다.

#### 다형성

- Movie는 동일한 메시지를 전송하지만 실제로 어떤 메서드가 실행될 것인지는 메시지를 수신하는 객체의 클래스가 무엇이냐에 따라 달라진다. 이를 **다형성** 이라고 부른다.
- 다형성은 객체지향 프로그램의 컴파일 시간 의존성과 실행 시간 의존성이 다를 수 있다는 사실을 기반으로 한다.
- 다형성이란 동일한 메시지를 수신했을 때 객체의 탄입에 따라 다르게 응답할 수 있는 능력을 의미한다.
    - 다형적인 협력에 참여하려면 메시지를 이해할 수 있어야 한다. → 인터페이스가 동일해야 한다.
- 다형성을 구현하는 방법은 다양하지만 메시지에 응답하기 위해 실행될 메서드를 컴파일 시점이 아닌 실행 시점에 결정한다는 공통점이 있다.
    - 메시지와 메서드를 실행 시점에 바인딩한다. → 이를 **지연 바인딩** 혹은 **동적 바인딩**이라고 부른다. (반대는 정적바인딩 또는 초기 바인딩)

#### 인터페이스와 다형성

- 구현없이 인터페이스만 공유하고 싶을 때는 인터페이스 라는 프로그래밍 요소를 사용한다.

# 05 추상화와 유연성

#### 추상화의 힘

- 추상화를 사용할 경우 2가지 장점
    - 요구사항의 정책을 높은 수준에서 서술 가능
        - → 아래 그림의 예시로 요구사항을 서술해보면 '영화 예매 요금은 최대 하나의 할인 정책과 다수의 할인 조건을 이용해 계산할 수 있다.'
        - 세부사항에 억눌리지 않고 상위 개념만으로 도메인의 중요한 개념을 설명할 수 있다.
    - 설계 유연성
        - 추상화를 이용해 상위 정책을 표현하면 기존 구조를 수정하지 않고도 새로운 기능을 쉽게 추가 확장할 수 있다.

  

![](https://wiki.navercorp.com/download/attachments/1351799544/image-2023-3-23_8-8-46.png?version=1&modificationDate=1679558927000&api=v2 "LEE JAE HYEON[ 이재현 ] > Chapter 02 객체지향 프로그래밍 > image-2023-3-23_8-8-46.png")

  

#### 유연한 설계

- 할인 정책이 없는 경우를 추가해보자.
    - 지금까지의 일관성을 유지하려면, 0원 이라는 할인 요금을 계산할 그대로 유지하는 할인 정책을 만들면 된다.
        - NoneDiscountPolicy
        - 그러면 다른 수정없이 기능 확장 가능

#### 추상 클래스와 인터페이스 트레이드오프

- 하지만 위 방식으로 NoneDiscountPolicy 구현하 경우, 호출하지 않을 getDiscoutAmount() 를 구현해야하는 문제가 발생한다.
- 따라서 다른 방법은, DiscountPolicy 를 추상클래스에서 인터페이스로 변경하는 방식이다.
- 어떤 설계가 더 좋은가.
    - 이상적으로는 인터페이스
    - 현실적으로는 추상클래스

#### 코드 재사용

- 코드 재사용에서는 상속보다 합성이 더 좋은 방법이라는 얘기를 많이 한다.
- 합성은 다른 객체의 인스턴스를 자신의 인스턴스 변수로 포함해서 재사용하는 방법이다.
    - Movie가 DiscountPolicy 코드를 재사용하는 방법이 합성이다.
    - 이를 상속으로 변경해볼 수 있다.
        - 예를들면, Movie 를 상속하여 AmountDiscoutMovie와 PercentDiscountMovie를 만드는 방법이다.
        - 이렇게 하면 기존 합성을 사용한 방법과 기능적으로 동일하다.
- 왜 합성이 더 좋은 방법인가?
    - 상속은 캡슐화를 위반하고,
        - 부모클래스의 구현이 자식 클래스에 노출되기 때문에 캡슐화가 약해진다.
    - 설계를 유연하지 못하게 한다.
        - 실행 시점에 객체 종류를 변경하는 것이 불가능해진다.

#### 합성

- Movie는 요금 계산하기 위해 DiscountPolicy 코드를 재사용한다.
    - Movie가 DiscountPolicy의 인터페이스를 통해 약하게 결합
    - 이처럼 인터페이스에 정의된 메시지를 통해서만 코드를 재사용하는 방법을 합성이라고 한다.
- 합성은 상속이 가지는 2가지 문제를 해결한다.
- 그렇다고 상속을 쓰지 말라는 것이 아니다.
- 대부분의 설계에서는 상속과 합성을 함께 사용해야 한다.
    - 코드를 재사용하는 경우에는 상속보다 합성
    - 다형성을 위해 인터페이스를 재사용하는 경우에는 상속과 합성을 함께 조합해서 사용할 수밖에 없다.**
