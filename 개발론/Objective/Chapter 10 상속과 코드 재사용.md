- 객체지향 프로그래밍에서 코드를 효과적으로 재사용하는 방법은 상속과 합성이 있다.
- 이번 장에선 상속에 대해 알아보자.

# 01 상속과 중복 코드

#### DRY 원칙

- 중복 코드는 변경을 방해한다.
    - 코드를 수정하는 데 필요한 노력을 몇배로 증가시킨다.
    - (315p) 발생할 수 있는 더 큰 문제는 중복 코드를 수정할 때 서로 다르게 수정할 수 있다는 점.
- 중복 여부 판단 기준은 변경이다.
- 프로그래머는 DRY 원칙을 따라야 한다.
    - Don't Repeat Yourself.
- 두 클래스 사이에 중복 코드를 제거하는 한가지 방법은 클래스를 하나로 합치는 것.
    - 대신 타입 코드를 추가하고, 타입 코드 값에 따라 분기 처리.
    - 이는 낮은 응집도와 높은 결합도 문제 발생

#### 상속을 이용해서 중복 코드 제거

- 상속의 기본 아이디어
    - 이미 존재하는 클래스와 유사한 클래스가 필요하다면 코드를 복사하지 말고 상속을 이용해 코드를 재사용하라는 것
- 그러나 상속과정에서 개발자의 가정이 많이 들어갈수록 코드 이해가 어려워진다.
- 319p 예시에서
    - 기대한 것 : 10시 이전 요금과 10시 이후 요금을 더하는 것
    - 실제 코드 : 10시 이전 요금에서 10시 이후 요금 차감해서 계산
- 결합도의 정의 : 하나으 미도류이 다른 모듈에 대 해 얼마나 많은 지식을 갖고 있는지를 나타내는 정도
    - 상속을 이용해 코드를 재활용하려면 부모 클래스의 개발자가 세웠던 가정이나 추론 과정을 정확히 이해해야 한다.
    - 즉, 상속은 결합도를 높인다.

  

|   |
|---|
|super 호출을 제거할 수 있는 방법을 찾아 결합도를 제거하라.|

# 02 취약한 기반 클래스 문제

- 취약한 기반 클래스 문제  
    : 부모 클래스의 변경에 의해 자식 클래스가 영향을 반는 현상
    - 캡슐화를 약화시키고, 결합도를 상승시킨다.

#### 불필요한 인터페이스 상속 문제

- Stack은 Vector를 상속하는데, 불필요하게 add라는 메서드까지 상속하고 있어 Stack 사용시 상위 클래스 메서드 오사용으로 인한 문제가 발생할 수 있다.

  

|   |
|---|
|상속받은 부모 클래스의 메서드가 자식 클래스의 내부 구조에 대한 규칙을 깨트릴 수 있다.|

  

#### 메서드 오버라이디의 오작용 문제

- 이펙티브 자바 - HashSet을 상속하는 InstrumentedHashSet 예시
    - addAll을 override 하여 super.addAll을 호출한다.
    - 이때 super.addAll 안에 add() 메서드가 포함되어 있어서, InstrumentedHashSet 자체적으로 호출하는 add() 포함하여 결국 중복으로 호출된다.

  

|   |
|---|
|자식 클래스가 부모 클래스의 메서드를 오버라이딩할 경우 부모 클래스가 자신의 메서드를 사용하는 방법에 자식 클래스가 결합될 수 있다.|

- 이런 클래스의 오버라이딩으로 인한 파급 효과를 분명하게 문서화야 해야 한다.
- 서브 클래스가 안전할 수 있게끔 클래스를 문서화하려면 클래스의 상세 구현 내역을 기술해야 하낟. (대신 캡슐화 위반)

  

#### 부모 클래스와 자식 클래스의 동시 수정 문제

- 자식 클래스는 부모 클래스의 구현에 강하게 결합되기 때문에 부모 클래스가 수정되면, 자식 클래스가 메서드 오버라이딩이나 불필요한 인터페이스를 상속받지 않아도 함께 수정해야할 경우가 발생한다.

  

|   |
|---|
|클래스를 상속하면 결합도로 인해 자식 클래스와 부모 클래스의 구현을 영원히 변경하지 않거나, 자식 클래스와 부모 클래스를 동시에 변경하거나 둘 중 하나를 선택할 수 밖에 없다.|

# 03 Phone 다시 살펴보기

- 상속으로 인한 피해를 최소화할 수 있는 방법을 찾아보자.

#### 추상화에 의존하자

- 자식 클래스는 부모 클래스에 의존성이 크다는게 문제였다.
- 이를 해결하려면, 자식 클래스가 부모 클래스의 구현이 아닌 추상화에 의존하도록 만드는 것
- 코드 중복을 제거하기 위해 상속을 도입할 때 따르는 2가지 원칙
    - 두 메서드가 유사해보인다면 차이점을 메서드로 추출하라.
        - 변하는 것으로부터 변하지 않는 것을 분리하라.
    - 부모 클래스 코드를 하위로 내리지 말고 자식 클래스의 코드를 상위로 올려라.

  

#### 추상화가 핵심이다

- 공통 크드를 이동시킨 후 각 클래스는 서로 다른 변경의 이유를 가진다.
- 새로운 요금제를 추가하기도 쉽다

  

# 04 차이에 의한 포로그래밍

- 기존 코드와 다른 부분만 추가함으로써 애플리케이션의 기능을 확장하는 방법 : 차이에 의한 프로그래밍
    - 목표 : 중복 코드를 제거하고 코드를 재사용하는 것
- 시간이 흐르고 객체지향에 대한 이해가 깊어지면서 사람들은 코드를 재사용하기 위해 맹목적으로 상속을 사용하는 것이 위험하다는 것을 깨닫는다.
    - 코드 재사용 측면에서 매우 강력
    - 하지만 잘못 사용할 경우 돌아오는 피해도 크다.
- 상속의 단점은 피하면서 코드 재사용 방법이 있다. 바로 합성. (다음 챕터)
