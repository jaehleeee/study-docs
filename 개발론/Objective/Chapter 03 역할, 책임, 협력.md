객체지향에서 가장 중요한 것은 역할, 책임, 협력이다.

# 01 협력

- 객체지향 원칙을 따르는 애플리케이션의 제어 흐름은 어떤 하나의 객체에 의해 통제되지 않고 다양한 개체들 사이에 균형 있게 분배되는 것이 일반적
- 객체들은 요청의 흐름을 따라 자신에게 분배된 로직을 실행하면서 애플리케이션의 전체 기능을 완성한다
- 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용을 **협력** 이라고 한다.
- 객체가 협력에 참여하기 위해 수행하는 로직은 **책임**
- 객체들이 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 **역할**을 구성

#### 협력

- 객체는 고립된 존재가 아니라 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 협력하는 사회적인 존재다.
- 메시지 전송은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다.
- 협력이란 어떤 객체가 다른 객체에게 무엇인가 요청하는 것
- 메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다.
    - 여기서 객체가 메시지를 처리할 방법을 스스로 선택한다는 점이 중요
- Screening 이 Movie에게 요금 계산을 위임하는 이유는 요금 계산에 대한 정보를 가장 잘아는 객체가 Movie이기 때문이다.
    - Screening 이 만약 직접 계산하려고 한다면? Movie는 수동적인 존재가 되고 자율성이 훼손된다.
- 결과적으로 객체를 자율적으로 만드는 가장 기본적인 방법은 **내부 구현을 캡슐화하는 것**이다.

#### 협력이 설계를 위한 문맥을 결정한다

- 객체가 가질 수 있는 상태와 행동을 어떤 기준으로 결정해야 할까?
- 애플리케이션 안에 어떤 객체가 필요하다면 그 이유는 단 하나다. 어떤 협력에 참여하고 있기 때문이다.
- 객체의 행동을 결정하는 것은 **객체가 참여하고 있는 협력**이다.
- 협력이 바뀌면 객체가 제공해야하는 행동도 바뀌어야 한다.
- Movie 객체 예시
    - Movie 객체의 행동을 결정하는 것은 영화 예매를 위한 협력
- 객체의 행동을 결정하는 것이 협력이라면, 객체의 상태를 결정하는 것은 행동이다.
- 객체는 자신의 상태를 스스로 결정하고 관리하는 자율적인 존재이기 때문에 객체가 수행하는 행동에 필요한 상태도 함께 가지고 있어야 한다.
- 결과적으로 객체가 참여하는 협력이 객체를 구성하는 행동과 상태 모두를 결정한다.
- 따라서 협력은 객체를 설계하는 데 필요한 일종의 문맥을 제공한다.
    - **문맥 결정 : 협력 → 객체의 행동 → 객체의 상태**
        - 상태 : 필드
        - 행동 : 메서드

# 02 책임

#### 책임이란 무엇인가

- 협력에 참여하기 위해 객체가 수행하는 행동을 **책임** 이라고 부른다.
- 책임이란 객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 유지해야 하는 정보와 수행할 수 있는 행동에 대한 개략적으로 서술한 문장이다.
- 객체의 책임은 다음 2가지로 구성된다.
    - 무엇을 알고 있는가 **knowing** (상태?)
    - 무엇을 할 수 있는가 **doing** (행동?)
- Screening이 reserve 메시지를 수신하고, movie 인스턴스 변수를 포함하는 이유는 협력 안에서 영화를 예매할 책임을 수행해야 하기 때문
- 이처럼 협력 안에서 객체에게 할당한 책임이 외부의 인터페이스와 내부의 속성을 결정한다.
- 책임은 객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술하기 때문에 메시지보다 추상적이고 개념적으로도 더 크다.
- 책임의 관점에서 중요한 사실
    - 아는 것과 하는 것이 밀접하게 연관돼 있다.
    - 객체는 자신이 맡은 책임을 수행하는데 필요한 정보를 알고 있을 책임이 있다
    - 객체는  자신이 할 수 없는 작업을 도와줄 객체를 알고 있을 책임이 있다.
- 객체지향 개발에서 가장 중요한 능력 "책임을 능숙하게 소프트웨어 객체에 할당하는 것"
- 객체지향 설계에서 가장 중요한 것은 책임
    - 적절한 책임을 할당하느냐가 설계의 전체적인 품질을 결정

#### 책임 할당

- 자율적인 객체를 만드는 가장 기본적인 방법  
     : 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것  
     : Information Expert 패턴
- 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야한다.
    - **협력 설계 출발점**은 시스템이 이용자에게 제공하는 기능을 시스템이 담당할 하나의 책임으로 바라보는 것
    - 객체지향 설계는 시스템의 책임을 완료하는 데 필요한 더 작은 책임을 찾아내고 이를 객체들에게 할당하는 반복적인 과정을 통해 모양을 갖춰나간다.
- 영화 예매 시스템을 예로 들어 정보 전문가에게 책임을 할당하는 방법
    1. 객체가 책임을 수행하는 유일한 방법은 메시지를 전송하는 것이므로 책임을 할당한다는 것은 메시지의 이름을 결정하는 것과 같다.
    2. _`'1. 예매하라'`_  메시지 결정
    3. 결정했다면 메시지 처리할 객체 선택
        - 영화를 예매하기 위해 상영 시간과 기본 요금 알아야 한다.  :
    4. _'Screening'_
        - 영화를 예매하기 위해서는 예매 가격을 계산해야 한다.
    5. _`'2. 가격 계산하라'`_
    6. _'Movie'_
- 이처럼 **객체 지향 설계**는 협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복적인 과정을 통해 이뤄진다.
- 그리고 이런 메시지가 메시지를 수신할 객체의 책임을 결정한다.

(메시지가 정해지기 전에 Screening, Movie라는 객체는 미리 정해놓은 건인가. 아니면 그때그때 만드는 것인가)

  

#### 책임 주도 설계

- 협력을 설계하기 위해서는 책임에 초점을 맞춰야 한다.
- 이처럼 책임을 찾고 책임을 수행할 적절한 객체를 찾아 할당하는 방식으로 협력을 설계하는 방법을  
     : **책임 주도 설계 RDD** 라고 부른다.

  

|   |
|---|
|- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.<br>- 시스템 책임을 더 작은 책임으로 분할한다.<br>- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.<br>- 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.<br>- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.|

#### 책임을 할당할때 고려해야할 2가지 요소

#####  1. 메시지가 객체를 결정한다

- 객체에게 책임을 할당하는 데 필요한 메시지를 먼저 식별하고 메시지를 처리할 객체를 나중에 선택했다는 것이 중요하다.
- 다시 말해 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 했다.
- 메시지가 객체를 선택해야 하는 2가지 이유
    - 객체가 최소한의 인터페이스를 가질 수 있게 된다. - 필요한 메시지가 식별될 때까지 객체의 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문
    - 객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다. - 무엇을 하는지는 표현해야 하지만, 어떻게 하는지는 노출해서는 안된다.

######  2. 행동이 상태를 결정한다.

- 객체를 객체답게 만드는 것은 객체가 다른 객체에게 제공하는 행동이다.
- 얼마나 적절한 객체를 창조했느냐는 얼마나 적절한 책임을 할당했느냐에 달려있고, 책임이 얼마나 적절한지는 협력에 얼마나 적절한지에 달려있다.
- 객체지향 초보일수록 행동이 아니라 상태에 초점을 맞춘다. 초보자가 자주하는 실수는?
    - **캡슐화 저해** : 내부 구현이 객체의 퍼블릭 인터페이스도 함께 변경되고, 결국 객체에 의존하는 클라이언트로 변경의 영향이 전파된다.
    - **데이터 주도 설계** : 객체의 내부 구현에 초점을 맞춘 설계 방법
- 캡슐화를 위반하지 않도록 구현에 대한 결정을 뒤로 미루면서 객체의 행위를 고려하기 위해서는 항상 협력이라는 문맥 안에서 객체를 생각해야 한다.
- 다시한번 강조한다.
- 행동이 중요하다.
- 협력이 행동을 결정하고, 행동이 상태를 결정한다. 그리고 그 행동이 바로 객체의 책임이 된다.

  

# 03 역할

#### 역할과 협력

- 객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합을 **역할** 이라고 부른다
- 영화 에매 협력에서 예매하라 라는 메시지를 처리하기에 적합한 객체로 Screening 을 선택할때 2가지 단계로 나뉜다
    - 영화를 예매할 수 있는 적절한 역할이 무엇인가
    - 역할을 수행할 객체로 Screening 인스턴스를 선택하는 것

#### 유연하고 재사용 가능한 협력

- 열할이 중요한 이유  
     : 역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문
- 역할이 아닌 객체에 집중하면 유연성이 떨어진다.
- 역할은 여러 종류의 객체를 포괄하는 추상화가 필요하다.
- 역할을 이용하면 불필요한 중복 코드를 제거할 수 있다.
- 또한 협력이 더 유연해졌다.
    - ex) 새로운 할인 정책을 추가하기 위해 새로운 협력을 추가할 필요가 없어졌다.

![](https://wiki.navercorp.com/download/attachments/1360574151/image-2023-3-31_7-57-33.png?version=1&modificationDate=1680249454000&api=v2 "LEE JAE HYEON[ 이재현 ] > Chapter 03 역할, 책임, 협력 > image-2023-3-31_7-57-33.png")

  

#### 객체 대 역할

- 오직 한 종류의 객체만 협력에 참여하는 상황에서 역할이라는 개념을 고려하는 것이 유용할까?
    - 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 역할이 되지만,
    - 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다.
- 객체에 관해 생각할 때 '이 객체가 무슨 역할을 수행해야 하는가?' 라고 자문하는 것이 도움이 된다.
- 대부분의 경우에 어떤 것이 역할이고 어떤 것이 객체인지가 또렷하게 드러나지는 않을 것이다.
    - 이에 대한 개인적 견해는 설계 초반에는 절적한 책임과 협력의 큰 그림을 탐색하는 것이 가장 중요한 목표여야 하고
    - 역할과 객체를 명확하게 구분하는 것은 그러게 중요하지는 않다는 것이다.
    - 애매하다면 단순하게 객체로 시작하고 반복적으로 책임과 협력을 정제해가면서 필요한 순간에 객체로부터 역할을 분리해내는 것이 가장 좋다.
- 처음 특정 시나리오에 대한 협력을 구상할 때는 아마도 도메인 모델에 있는 개념들을 후보로 선택해 직접 책임을 할당할 것이다.
    - 협력을 지속적으로 정제하다 보면 두 협력이 거의 유사한 구조를 보인다는 것을 발견
    - 두 협력을 하나로 합치면서 두 객체를 포괄할 수 있는 역할을 고려해서 객체를 역할로 대체할 수 있다. (→ 리팩토링?)
- 다양한 객체들이 협력에 참여한다는 것이 확실하다면 역할로 시작하라.

  

#### 역할과 추상화

- 추상화 장점
    1. 추상화 계층만을 이용하면 중요한 정책을 상위 수준에서 **단순화**할 수 있다
    2. 설계가 좀 더 **유연**해진다

  

#### 배우와 배역

- 협력은 연극과 동일하고 코드는 극본과 동일하다
    - 협력 : 연극
    - 배역 : 역할
    - 배우 : 객체
- 협력이라는 문맥 안에서 역할은 특정한 협력에 참여해서 책임을 수행하는 객체의 일부다
- 역할은 객체의 페르소나다.
- 객체 역시 여러 협력에 참여하면서 다양한 역할을 수행할 수 있다.
    - 특정한 협력 안에서는 일시적으로 오직 하나의 역할만이 보여진다.
    - 객체는 다양한 역할을 가질 수 있다.
