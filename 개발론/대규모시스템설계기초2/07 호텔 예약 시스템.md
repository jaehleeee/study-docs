# 7장 호텔 예약 시스템
 * 호텔 체인의 예약 시스템 혹은 에어비앤비, 항공권, 영화 티켓 예매 등의 시스템 설계

## 1단계: 문제 이해 및 설계 범위 확정
### 기본 요구사항
 * 5000개 호텔
 * 100만개 객실
 * 평균 객실 70% 사용, 평균 투숙 3일
 * 10% 초과 예약 가능
 * 요금은 예약시 지불
 * 지원 기능: 호텔 정보 / 객실 정보 / 객실 예약 / 호텔이나 객실 정보 CRUD / 초과 예약 지원
 * 객실 가격은 유동적 - 그날 객실 여유 상황에 딸 ㅏ 다름

### 비기능 요구사항
 * 높은 수준의 동시성
 * 적절한 지연 시간 - 몇 초 정도 걸리는건 괜찮다

### 개략적 규모 추정
 * 일일 예약 건수 = 1백만 객실 * 70% 사용률 / 평균 3일 투숙 = 약 240,000
 * 초당 예약 건수 = 240,000 / 하루 10000초 = 약 3.xxx (트래픽 높지 않음)
 * 시스템 내 QPS는?
   * 보통 웹사이트는 10% 사용자가 다음 단계로 진입한다.
   * 객실 예약 페이지 QPS가 3 이므로 역산 가능
   * 객실 상세 페이지 (QPS:300) -> 예약 상세 페이지 (QPS:30) -> 객실 예약 페이지 (QPS:3)

## 2단계: 개략적 설계안 제시 및 동의 구하기
### API 설계
 * 호텔 관련 API - 호텔 CRUD
 * 객실 관련 API - 객실 CRUD
 * 예약 관련 API - 예약 이력, 신규 예약, 예약 취소 등
 * reservation_id가 이중 예약을 방지하는 멱등 키 이다.

### 데이터 모델
 * 어떤 DB 사용할지 결정하기 전에 데이터 접근 패턴부터 살펴봐야 한다.
   * 호텔 상세 정보 / 해당 날짜 사용 가능 객실 유형 확인 / 예약 정보 확인 / 예약 내역 확인
 * 대규모 이벤트가 있다면 트래픽 급증 가능 -> 대비 필요
 * 읽기 빈도가 쓰기보다 높으므로 관계형 DB 로 결정.
   * 특히 ACID 속성은 예약 시스템 만들때 중요
   * 데이터 모델링도 쉽다.
 * 데이터 모델에서 주요한 부분은 reservation 테이블의 status 필드
   * pending, paid, refund, canceled, rejected
 * 스키마 디자인에서 문제가 될 수 있는 부분은 room_id 이다.
   * 에어비앤비 같은 회사엔 적합하지만, 호텔은 아니다.
   * 사용자는 특정 객실을 예약하지 않고 객실 유형으로 예약한다.
   * 나중에 개선하자. 

### 개략적 설계안
 * MSA 아키텍쳐
 * 공개 API 게이트웨이 : 처리율 제한, 인증 등의 기능 지원하며, 엔드포인트 기반으로 요청을 전달한다.
 * 내부 API : 승인된 호텔 직원만 사용, VPN 등의 기술로 외부 공격으로부터 보호
<img src="https://github.com/user-attachments/assets/514a0991-8ba0-4e48-b62a-8660387d1bd7" width="500"/>


## 3단계: 상세 설계
### 개선도니 데이터 모델
 * ㅇㅇ


### 동시성 문제
 * ㅇㅇ


### 시스템 규모 확장
 * ㅇㅇ


### MSA 데이터 일관성 문제 해결
 * ㅇㅇ



## 4단계: 마무리



