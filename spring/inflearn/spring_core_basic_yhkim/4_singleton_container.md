# 싱글톤 컨테이너

## 1. 싱글톤 패턴
 * 웹 어플리케이션에서 요청이 올때마다 객체가 생성되면 메모리 낭비가 매우 심할 것이다.
 * 이를 해결하기 위해 싱글톤 패턴이 나옴. - 객체를 딱 1개만 생성하고 공유해서 사용하기.
 * 외부에서 생성하지 못하도록 생성자를 private으로 설정
 * 객체 인스턴스가 필요하면 static 메서드를 통해 제공

#### 싱글톤 패턴 문제점
 * 구현 코드가 많이 들어간다.
 * 의존관계상 클라이언트가 구체 클래스에 의존한다. - DIP 위반
 * 테스트하기 어렵다.
 * 내부 속성을 변경하기 어렵다.
 * private 생성자때문에 자식 클래스 만들기 어렵다.



## 2. 싱글톤 컨테이너
 * 위에서 알아본 싱글톤 패턴의 문제점을 해결하면서, 객체 인스턴스를 싱글톤으로 관리한다.

### 싱글톤 방식의 주의점
 * 객체 인스턴스가 공유되기 때문에 stateful 하게 설계하면 안된다.
    * 특정 클라이언트에 의존적인 필드가 있으면 안된다.
    * 특정 클라이언트가 값을 변경할 수 있게 하면 안된다.
    * 가급적 읽기만 가능해야 한다.
    * 필드 대신에 자바에서 공유되지 않는 지역변수, 파리미터, ThreadLocal 등을 사용해야 한다.



## 3. @Configuration
 * 이 어노테이션은 싱글톤을 위해 필요한 어노테이션이라고 봐도 된다.
 * 스프링은 클래스의 바이트코드를 조작하는 라이브러리를 사용한다
    * 일반적인 클래스 인스턴스의 getClass를 출력해보면, 클래스 패키지명이 나온다. `com.company.service.MemberService$${참조값}`
    * 그런데 bean 클래스 인스턴스의 getClass를 출력해보면, 패키지명 뒤에 뭔가 붙는다. `com.company.service.MemberService$$EnhancerBySpringCGLIB$${참조값}`
    * 빈 클래스는 내가 코드로 작성한 클래스가 아니라 CGLIB 라는 바이트코드 조작 라이브러리를 사용해서 기존 클래스를 상속받은 임의 클래스를 만들고, 이를 스프링 빈으로 등록한 것이다!
    * 이 임의 클래스가 바로 싱글톤을 보장해준다.
 * @Bean 이 붙은 메서드마다 이미 스프링 빈이 존재하면 존재하는 빈을 반환하고, 없으면 생성해서 빈으로 등록 후 반환한다.
 * @Configuration 안 붙이면?
    * @Bean 만 적용하면, 빈으로 등록되긴한다.
    * 대신 CGLIB 기술이 적용되지 않기 때문에 싱글톤은 적용되지 않는다.
