# AOP

## 핵심기능과 부가기능
 * 애플리케이션은 핵심 로직과 부가 기능으로 나눌 수 있다.
 * 보통 부가기능은 여러 클래스에 걸쳐서 사용된다. (ex: 로깅, 트랜잭션 기능)
 * 이러한 부가 기능을 횡단 관심사(cross-cutting concerns)라고 한다.
 * 부가 기능 적용의 일반적인 문제
    * 아주 많은 반복이 필요
    * 수정시 수정할 곳이 많다.


## AOP 소개
 * 부가 기능 적용의 문제를 해결하기 위해 AOP 개념 도입.
 * 부가 기능을 핵심 기능과 분리하고 한 곳에서 관리하자. 그리고 부가 기능을 어디에 적용할지 선택하는 기능도 추가.
 * Aspect 는 쉽게 말해 부가 기능과 해당 부가 기능을 어디에 적용할지 정의한 것.
 * Aspect 를 적용한 프로그래밍 방식을 Aspect Oriented Programming AOP 라고 한다.
 * AOP는 OOP를 대체하는 것이 아니라, 부족한 부분을 보조하는 목적으로 개발되었다.
 * AOP의 대표적인 구현이 AspectJ 프레임워크가 있다.

## AOP 사용가능 시점 3가지
#### 1. 컴파일 시점
 * `.java` -> `.class` 로 만드는 시점에, Aspect 컴파일러가 해당 클래스가 적용 대상인지 확인하고, 적용 대상인 경우 코드 단계에서 부가 기능 로직을 적용한다.
 * 단점 : 특별한 컴파일러가 필요.
 * (참고) 이렇게 원본 로직에 부가 기능 로직이 추가되는 것을 위빙(Weaving) 이라고 한다.
#### 2. 클래스 로딩 시점 (모니터링툴들이 주로 사용하는 방식)
 * 자바를 실행하면, `.class` 파일을 JVM 내부 클래스 로더에 보관한다. 이때 .class 파일을 조작하여 JVM에 올릴 수 있다.
 * 이를 활용하여 Ajpect를 적용하는 것을 로드 타임 위빙 이라고 한다.
 * 단점 : 자바 실행시 특별한 옵션(java 0-javaagent)을 통해 클래스 로더 조작기를 지정해야 하는데, 이 부분이 번거롭다.
#### 3. 런타임 시점 (프록시 적용)
 * 런타임 시점의 의미 : 컴파일되고, JVM에 클래스 파일들 다 올라가고, java의 메인 메서드도 이미 실행된 이후를 의미.
 * 이 시점에 적용하려면, 스프링 빈의 프록시를 통해 적용할 수 있다. (지금까지 배운 것들..)
 * 스프링 AOP는 이 방식을 사용한다.

## AOP 적용 위치 : Joint Point
 * 컴파일 시점이나 클래스 로딩 시점의 AOP는 바이트 코드를 실제 조작하기 때문에 모든 지점에서 적용가능하다.
 * 하지만 프록시 방식은 메서드 실행 지점에만 AOP를 적용할 수 있다.
    * 프록시 방식은 메서드 오버라이딩 개념으로 동작한다. 따라서 생성자, 필드 값 접근 등에는 적용할 수 없다.
    * 스프링 빈에만 AOP를 적용할 수 있다.

## AOP 용어 
#### Joint Point
 * AOP를 적용될 수 있는 위치를 나타내는 추상적인 개념 - 메서드 실행, 생성자 호출, 필드 값 접근 등
 * 스프링 AOP는 프록시 방식을 사용하므로 조인 포인트는 항상 메소드 실행 지점으로 제한된다.
#### 포인트컷
 * 조인 포인트 중에서 어드바이스가 적용될 위치를 선별하는 기능
 * 주로 AspectJ 표현식을 사용해서 지정
 * 프록시를 사용하는 스프링 AOP는 메서드 실행 지점만 포인트컷으로 선별 가능
#### 타겟
 * 어드바이스를 받는 객체
 * 부가기능을 추가할 핵심 기능이 있는 객체를 의미
#### 어드바이스
 * 특정 조인 포인트에서 Aspect에 의해 취해지는 부가 기능
 * Aroud, Before, After 같은 다양한 종류 어드바이스가 있음.
#### Aspect
 * 어드바이스 + 포인트컷을 모듈화 한 것.
 * 여러 어드바이스와 포인트컷이 함께 존재
#### Advisor
 * 1개의 어드바이스와 1개의 포인트컷으로 구성
 * 스프링 AOP에서만 사용되는 용어

