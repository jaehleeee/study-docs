# 전체 요약

#### 이번 강의의 주제는 핵심 기능과 부가적인 공통 기능이 있을때, 이를 어떻게 하면 잘 분리해서 사용할 수 있느냐에 대해 여러 기술적인 요소들을 살펴보고 최적화하는 것이다.

## 1. Thread Local
 *  Thread Local 를 초기화하지 않은채 쓰레드 재사용시 이전 값이 사용되는 위험 발생


## 2. 템플릿 메서드 패턴
 * 공통 기능은 추상클래스
 * 핵심 기능은 위 추상클래스를 상속한 구체 클래스에 정의
 * 상송의 단점이 있음.


## 3. 전략 패턴
 * Context 라는 클래스에 공통 기능을 넣고
 * 핵심 기능은 Strategy 라는 인터페이스를 만들고, 이를 구현한 클래스를 통해 핵심 기능을 구현한다.
 * Context는 Strategy를 의존하게 하여 핵심 기능을 실행시킨다.
 * 템플릿 메서드 패턴에서는 상속을 이용했다면, 여기선 위임을 이용한다.

## 4. 템플릿 콜백 패턴
 * 전략 패턴과 유사
 * 템플릿이 Context, 콜백이 Strategy 라고보면 된다.


#### 2~4 모두 원본 코드를 매번 수정해야한다는 단점 존재.

## 5~6 프록시 패턴과 데코레이터 패턴
 * 프록시 패턴과 데코레이터 패턴 형태는 거의 같지만, 목적에 따라 나뉨
    * 프록시 패턴은 접근 제어가 목적
    * 데코레이터 패턴은 새로운 기능 추가가 목적
 * 클라이언트가 프록시에 의존, 프록시가 핵심 기능이 있는 Target에 의존
    * Client -> Proxy -> Target
 * 이러한 패턴의 장점 2가지
    1. 부가 공통 기능 추가를 위해 핵심 기능 수정이 필요하지 않다.
    2. 클라이언트 입장에서 프록시 여부를 알 필요가 없다.
 * 단점 : 모든 구현 클래스의 프록시를 일일이 생성해줘야 한다 (<- 동적 프록시를 통해 개선)
 
 
## 7. 리플렉션
 * 클래스나 메서드의 메타 정보를 이용해 동적으로 메서드를 호출하는 방법
 * 런타임 단계에 동적으로 실행되므로, 컴파일 단계에서 에러를 잡지 못하는 치명적인 단점이 있다.
 
## 8. 동적 프록시
### 1) JDK 동적 프록시
 * InvocationHandler 라는 인터페이스를 구현하여 프록시 클래스 생성
    * Target 클래스를 의존함
 * Proxy.newProxyInstance(..) 를 통해 프록시 인스턴스 생성

### 2) CGLIB
 * Code Generator Library
 * 구체 클래스의 상속을 통해 프록시 생성
 * InvocationHandler 처럼 MethodInterceptor 를 통해 프록시 클래스 생성
 * Enhancer.create() 를 통해 프록시 인스턴스 생성


## 9. Proxy Factory
 * 인터페이스가 있으면 JDK 동적 프록시, 없으면 CGLIB 이렇게 매번 각 케이스를 구분해서 프록시를 생성하기엔 너무 번거롭다.
 * 이를 통합하여 프록시를 생성해주는 것이, `Proxy Factory` 이다.
 * 프록시 팩토리에 핵심 기능인 target을 설정하고, 부가기능인 advice를 설정하고, 언제 이 프록시를 적용할지 pointCut 설정을 통해 결정한다.
 * 하지만, 모든 스프링 빈 마다 프록시를 일일이 적용하는 것도 여전히 번거롭다. 이는 빈 후처리기로 적용되는 자동 프록시 생성기를 통해 해결 가능하다.

## 10. AnnotationAwareAspectJAutoProxyCreator
 * implementation 'org.springframework.boot:spring-boot-starter-aop' 를 추가하면, AnnotationAwareAspectJAutoProxyCreator가 활성화된다.
 * AnnotationAwareAspectJAutoProxyCreator 는 스프링 빈으로 등록된 advisor를 찾아서 필요한 곳에 프록시를 자동으로 생성해준다.
 * 따라서, 포인트컷과 어드바이스로 구성된 어드바이저를 만들어서 스프링 빈으로 등록하면, 자동 프록시 생성기가 모두 자동으로 적용을 도와준다.
    * 자동 프록시 생성기가 스프링 빈으로 등록된 어드바이저들을 찾고 해당되는 스프링 빈들에 자동으로 프록시를 적용해준다.


## 11. @Aspect
 * Aspect 애노테이션으로 매우 편리하게 포인트컷과 어드바이스로 구성되어 있는 어드바이저 생성 기능을 지원한다.
 * 이러한 기능을 사용할 수 있게 해주는 것도 자동 프록시 생성기인 (AnnotationAwareAspectJAutoProxyCreator) 의 역할 중 하나다.
    * 즉, `@Aspect` 가 붙은 크래스를 찾아서 Advisor로 만들어주는 역할을 한다. 
