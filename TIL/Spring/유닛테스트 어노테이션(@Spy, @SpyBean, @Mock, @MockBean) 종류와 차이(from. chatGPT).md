<p>Spring에서 <code>@Spy</code>, <code>@SpyBean</code>, <code>@Mock</code>, <code>@MockBean</code> 어노테이션들은 <strong>테스트 시 의존성을 대체하거나 감시</strong>하는 데 사용됩니다. 각각의 역할과 사용 목적이 다릅니다. 특히, <code>@Spy</code>와 <code>@Mock</code>은 <strong>Mockito</strong>에서 제공하는 기본 어노테이션이고, <code>@SpyBean</code>과 <code>@MockBean</code>은 <strong>Spring Boot</strong>에서 제공하는 기능으로 <strong>Spring 컨텍스트</strong>에 직접적으로 연관되어 있습니다.</p><h3>1. <code>@Mock</code> (Mockito)</h3><ul><li><strong>Mockito</strong>에서 제공하는 어노테이션으로, <strong>가짜(Mock) 객체</strong>를 생성합니다.</li><li>실제 객체와는 무관하게, <strong>메서드 호출의 반환값을 미리 설정</strong>할 수 있습니다.</li><li>객체의 메서드가 호출되면 실제 동작이 실행되지 않고, 모킹된 동작이 수행됩니다.</li></ul><pre class="!overflow-visible"><div class="contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary dark:bg-gray-950"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary">java</div><div class="sticky top-9 md:top-[5.75rem]"><div class="absolute bottom-0 right-2 flex h-9 items-center"><div class="flex items-center rounded bg-token-sidebar-surface-primary px-2 font-sans text-xs text-token-text-secondary dark:bg-token-main-surface-secondary"><span class="" data-state="closed"><button class="flex gap-1 items-center py-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 5C7 3.34315 8.34315 2 10 2H19C20.6569 2 22 3.34315 22 5V14C22 15.6569 20.6569 17 19 17H17V19C17 20.6569 15.6569 22 14 22H5C3.34315 22 2 20.6569 2 19V10C2 8.34315 3.34315 7 5 7H7V5ZM9 7H14C15.6569 7 17 8.34315 17 10V15H19C19.5523 15 20 14.5523 20 14V5C20 4.44772 19.5523 4 19 4H10C9.44772 4 9 4.44772 9 5V7ZM5 9C4.44772 9 4 9.44772 4 10V19C4 19.5523 4.44772 20 5 20H14C14.5523 20 15 19.5523 15 19V10C15 9.44772 14.5523 9 14 9H5Z" fill="currentColor"></path></svg>코드 복사</button></span></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-java"><span class="hljs-meta">@Mock</span>
<span class="hljs-keyword">private</span> MyService myService;

<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMock</span><span class="hljs-params">()</span> {
    when(myService.getData()).thenReturn(<span class="hljs-string">"mock data"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> myService.getData();
    assertEquals(<span class="hljs-string">"mock data"</span>, result);  <span class="hljs-comment">// 모킹된 값이 반환됨</span>
}
</code></div></div></pre><ul><li><strong>사용 시점</strong>: Spring이 아닌 단순한 단위 테스트에서 의존성을 모킹할 때.</li></ul><hr><h3>2. <code>@MockBean</code> (Spring Boot)</h3><ul><li><strong>Spring Boot</strong>에서 제공하는 어노테이션으로, <strong>Spring 애플리케이션 컨텍스트에 있는 빈을 모킹</strong>합니다.</li><li>테스트할 때 <strong>기존 빈을 모킹된 빈으로 대체</strong>하여, 모킹된 객체가 의존성 주입을 통해 다른 서비스에 주입됩니다.</li><li>통합 테스트에서 사용되며, 실제 애플리케이션의 컨텍스트가 필요한 경우 유용합니다.</li></ul><pre class="!overflow-visible"><div class="contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary dark:bg-gray-950"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary">java</div><div class="sticky top-9 md:top-[5.75rem]"><div class="absolute bottom-0 right-2 flex h-9 items-center"><div class="flex items-center rounded bg-token-sidebar-surface-primary px-2 font-sans text-xs text-token-text-secondary dark:bg-token-main-surface-secondary"><span class="" data-state="closed"><button class="flex gap-1 items-center py-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 5C7 3.34315 8.34315 2 10 2H19C20.6569 2 22 3.34315 22 5V14C22 15.6569 20.6569 17 19 17H17V19C17 20.6569 15.6569 22 14 22H5C3.34315 22 2 20.6569 2 19V10C2 8.34315 3.34315 7 5 7H7V5ZM9 7H14C15.6569 7 17 8.34315 17 10V15H19C19.5523 15 20 14.5523 20 14V5C20 4.44772 19.5523 4 19 4H10C9.44772 4 9 4.44772 9 5V7ZM5 9C4.44772 9 4 9.44772 4 10V19C4 19.5523 4.44772 20 5 20H14C14.5523 20 15 19.5523 15 19V10C15 9.44772 14.5523 9 14 9H5Z" fill="currentColor"></path></svg>코드 복사</button></span></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-java"><span class="hljs-meta">@MockBean</span>
<span class="hljs-keyword">private</span> MyService myService;

<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> AnotherService anotherService;

<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMockBean</span><span class="hljs-params">()</span> {
    when(myService.getData()).thenReturn(<span class="hljs-string">"mock data"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> anotherService.process();
    assertEquals(<span class="hljs-string">"mock data"</span>, result);  <span class="hljs-comment">// `myService`의 모킹된 동작이 주입된 `anotherService`에서 사용됨</span>
}
</code></div></div></pre><ul><li><strong>사용 시점</strong>: Spring 컨텍스트가 필요하고, 해당 컨텍스트 내의 빈을 모킹해야 할 때.</li></ul><hr><h3>3. <code>@Spy</code> (Mockito)</h3><ul><li><strong>Mockito</strong>에서 제공하는 어노테이션으로, <strong>실제 객체를 감시(Spy)하여 부분적으로 모킹</strong>합니다.</li><li>객체의 일부 메서드는 실제로 호출되고, 다른 메서드는 모킹된 값을 반환할 수 있습니다.</li><li>기본적으로 실제 객체를 사용하며, 특정 메서드의 동작을 변경할 수 있습니다.</li></ul><pre class="!overflow-visible"><div class="contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary dark:bg-gray-950"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary">java</div><div class="sticky top-9 md:top-[5.75rem]"><div class="absolute bottom-0 right-2 flex h-9 items-center"><div class="flex items-center rounded bg-token-sidebar-surface-primary px-2 font-sans text-xs text-token-text-secondary dark:bg-token-main-surface-secondary"><span class="" data-state="closed"><button class="flex gap-1 items-center py-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 5C7 3.34315 8.34315 2 10 2H19C20.6569 2 22 3.34315 22 5V14C22 15.6569 20.6569 17 19 17H17V19C17 20.6569 15.6569 22 14 22H5C3.34315 22 2 20.6569 2 19V10C2 8.34315 3.34315 7 5 7H7V5ZM9 7H14C15.6569 7 17 8.34315 17 10V15H19C19.5523 15 20 14.5523 20 14V5C20 4.44772 19.5523 4 19 4H10C9.44772 4 9 4.44772 9 5V7ZM5 9C4.44772 9 4 9.44772 4 10V19C4 19.5523 4.44772 20 5 20H14C14.5523 20 15 19.5523 15 19V10C15 9.44772 14.5523 9 14 9H5Z" fill="currentColor"></path></svg>코드 복사</button></span></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-java"><span class="hljs-meta">@Spy</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyService</span>();  <span class="hljs-comment">// 실제 객체</span>

<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSpy</span><span class="hljs-params">()</span> {
    when(myService.getData()).thenReturn(<span class="hljs-string">"spy data"</span>);  <span class="hljs-comment">// 특정 메서드만 모킹</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> myService.getData();
    assertEquals(<span class="hljs-string">"spy data"</span>, result);  <span class="hljs-comment">// 모킹된 값 반환</span>
    verify(myService, times(<span class="hljs-number">1</span>)).getData();  <span class="hljs-comment">// 실제 메서드 호출 여부 검증 가능</span>
}
</code></div></div></pre><ul><li><strong>사용 시점</strong>: 실제 객체의 동작을 유지하면서 특정 메서드만 모킹하고 싶을 때.</li></ul><hr><h3>4. <code>@SpyBean</code> (Spring Boot)</h3><ul><li><strong>Spring Boot</strong>에서 제공하는 어노테이션으로, <strong>Spring 컨텍스트에 등록된 빈을 감시(Spy)할 수 있습니다</strong>.</li><li>컨텍스트에 있는 실제 빈의 일부 메서드는 그대로 호출되고, 일부 메서드는 모킹된 동작을 설정할 수 있습니다.</li><li><code>@SpyBean</code>은 컨텍스트에 존재하는 빈을 감싸는 형태로 동작합니다.</li></ul><pre class="!overflow-visible"><div class="contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary dark:bg-gray-950"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between rounded-t-md h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary">java</div><div class="sticky top-9 md:top-[5.75rem]"><div class="absolute bottom-0 right-2 flex h-9 items-center"><div class="flex items-center rounded bg-token-sidebar-surface-primary px-2 font-sans text-xs text-token-text-secondary dark:bg-token-main-surface-secondary"><span class="" data-state="closed"><button class="flex gap-1 items-center py-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-sm"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 5C7 3.34315 8.34315 2 10 2H19C20.6569 2 22 3.34315 22 5V14C22 15.6569 20.6569 17 19 17H17V19C17 20.6569 15.6569 22 14 22H5C3.34315 22 2 20.6569 2 19V10C2 8.34315 3.34315 7 5 7H7V5ZM9 7H14C15.6569 7 17 8.34315 17 10V15H19C19.5523 15 20 14.5523 20 14V5C20 4.44772 19.5523 4 19 4H10C9.44772 4 9 4.44772 9 5V7ZM5 9C4.44772 9 4 9.44772 4 10V19C4 19.5523 4.44772 20 5 20H14C14.5523 20 15 19.5523 15 19V10C15 9.44772 14.5523 9 14 9H5Z" fill="currentColor"></path></svg>코드 복사</button></span></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="!whitespace-pre hljs language-java"><span class="hljs-meta">@SpyBean</span>
<span class="hljs-keyword">private</span> MyService myService;  <span class="hljs-comment">// 실제 빈을 Spy로 감시</span>

<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSpyBean</span><span class="hljs-params">()</span> {
    when(myService.getData()).thenReturn(<span class="hljs-string">"spy data"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> myService.getData();
    assertEquals(<span class="hljs-string">"spy data"</span>, result);  <span class="hljs-comment">// 모킹된 값 반환</span>
    verify(myService, times(<span class="hljs-number">1</span>)).getData();  <span class="hljs-comment">// 실제 메서드 호출 검증 가능</span>
}
</code></div></div></pre><ul><li><strong>사용 시점</strong>: Spring 컨텍스트 내에서 실제 빈의 일부 동작을 모킹하면서 테스트하고자 할 때.</li></ul><hr><h3>주요 차이점 요약</h3>

어노테이션 | 제공 주체 | 설명 | Spring 컨텍스트 필요 여부 | 실제 객체 사용 여부
-- | -- | -- | -- | --
@Mock | Mockito | 가짜 객체를 생성하여 테스트에서 사용 | 필요 없음 | 사용하지 않음
@MockBean | Spring | Spring 컨텍스트 내의 빈을 모킹하여 테스트 | 필요 | 사용하지 않음
@Spy | Mockito | 실제 객체를 감시하고, 부분적으로 모킹 | 필요 없음 | 사용함
@SpyBean | Spring | Spring 컨텍스트 내의 빈을 감시하여 일부는 실제 호출, 일부는 모킹 | 필요 | 사용함

<hr><h3>언제 사용해야 하나?</h3><ul><li><strong><code>@Mock</code></strong>: 단순한 단위 테스트에서 객체의 동작을 완전히 모킹하고자 할 때 사용합니다.</li><li><strong><code>@MockBean</code></strong>: Spring 통합 테스트에서 실제 빈을 모킹하여 주입받는 다른 빈에서 이를 사용하고자 할 때 유용합니다.</li><li><strong><code>@Spy</code></strong>: 실제 객체의 일부 메서드를 테스트하고 싶고, 특정 메서드는 모킹하려 할 때 사용합니다.</li><li><strong><code>@SpyBean</code></strong>: Spring 컨텍스트에서 실제 빈의 일부 동작을 유지하면서, 필요한 메서드만 모킹하고 싶을 때 사용합니다.</li></ul>
